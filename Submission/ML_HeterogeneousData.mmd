graph TB
    subgraph "Challenge 1: Platform-Specific Data Formats"
        WA_Raw[WhatsApp Raw Data<br/>JSON from whatsmeow<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>external_id: hex string<br/>message.conversation: text<br/>reactions: separate messages<br/>media: thumbnail + S3 key<br/>messageTimestamp: unix]
        
        iMsg_Raw[iMessage Raw Data<br/>SQLite chat.db rows<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ROWID: integer<br/>attributedBody: BLOB<br/>date: Apple Cocoa epoch<br/>reactions: type codes<br/>2000=like, 2001=love]
        
        Email_Raw[Email/Calendar Raw<br/>IMAP MIME multipart<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>text/plain + text/html<br/>In-Reply-To headers<br/>quoted-printable encoding<br/>.ics VEVENT attachments<br/>RRULE: recurring events]
        
        Normalizer[Schema Normalizer<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Unified Message Schema<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Parse platform format<br/>â€¢ Convert timestamps<br/>â€¢ Merge reactions<br/>â€¢ Extract entities<br/>â€¢ Decode encodings<br/>â€¢ Expand recurrences]
        
        Unified[Unified Message<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Standard JSON schema<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: UUID<br/>platform: enum<br/>timestamp: ISO-8601<br/>sender: Contact<br/>recipients: Contact array<br/>content: Content<br/>metadata: Metadata<br/>embedding_metadata: NLP]
        
        WA_Raw --> Normalizer
        iMsg_Raw --> Normalizer
        Email_Raw --> Normalizer
        Normalizer --> Unified
    end
    
    subgraph "Challenge 2: Contact Identity Resolution"
        Contact_WA[WhatsApp Contact<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>identifier: +1-555-1234<br/>display_name: John Smith]
        
        Contact_iMsg[iMessage Contact<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>identifier: john.smith@icloud.com<br/>display_name: John Smith]
        
        Contact_Email1[Work Email Contact<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>identifier: john.smith@company.com<br/>display_name: John Smith]
        
        Contact_Email2[Personal Email<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>identifier: jsmith@gmail.com<br/>display_name: J. Smith]
        
        Resolver[Probabilistic Resolver<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>fuzzywuzzy library<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>1. Exact match check<br/>2. Fuzzy name match >80%<br/>3. User confirmation<br/>4. Create/link canonical ID]
        
        Canonical[Canonical Contact<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>contact_uuid: abc-123<br/>display_name: John Smith<br/>identifiers:<br/>  â€¢ +1-555-1234 WhatsApp<br/>  â€¢ john.smith@icloud.com<br/>  â€¢ john.smith@company.com<br/>  â€¢ jsmith@gmail.com<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Benefits:<br/>âœ“ Cross-platform search<br/>âœ“ Participant matching<br/>âœ“ Privacy-preserving local]
        
        Contact_WA --> Resolver
        Contact_iMsg --> Resolver
        Contact_Email1 --> Resolver
        Contact_Email2 --> Resolver
        Resolver --> Canonical
    end
    
    subgraph "Challenge 3: Multilingual Semantic Matching"
        Query_EN[User Query<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Language: English<br/>Text: vacation plans]
        
        Msg_EN[Message English<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>vacation plans<br/>embedding: 0.567, ...]
        
        Msg_ES[Message Spanish<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>planes de vacaciones<br/>embedding: 0.561, ...]
        
        Msg_DE[Message German<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>UrlaubsplÃ¤ne<br/>embedding: 0.543, ...]
        
        Msg_JA[Message Japanese<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>è¨ˆç”»ã‚’ä¼‘æš‡<br/>embedding: 0.512, ...]
        
        ML_Engine[OpenAI Embeddings<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>text-embedding-3-small<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Trained on 100+ languages<br/>â€¢ Cross-lingual clustering<br/>â€¢ Semantic vector space<br/>â€¢ Language-agnostic search]
        
        Results[Semantic Search Results<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Cosine Similarity Rankings:<br/>1. vacation plans EN 1.00<br/>2. planes de vacaciones ES 0.82<br/>3. UrlaubsplÃ¤ne DE 0.78<br/>4. è¨ˆç”»ã‚’ä¼‘æš‡ JA 0.71<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>MIRACL Benchmark:<br/>â€¢ English: 96% accuracy<br/>â€¢ Spanish: 94%<br/>â€¢ German: 92%<br/>â€¢ French: 93%<br/>â€¢ Arabic: 88%<br/>â€¢ Mandarin: 86%]
        
        Query_EN --> ML_Engine
        Msg_EN --> ML_Engine
        Msg_ES --> ML_Engine
        Msg_DE --> ML_Engine
        Msg_JA --> ML_Engine
        ML_Engine --> Results
        
        Lang_Detect[spaCy Language Detection<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>70+ languages<br/>95%+ accuracy<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Display flags in UI<br/>â€¢ Language-specific parsing<br/>â€¢ Unicode tokenization FTS5<br/>â€¢ Lemmatization per language]
        
        ML_Engine -.-> Lang_Detect
    end
    
    subgraph "Challenge 4: Temporal Distribution Variance"
        Event[Calendar Event<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Q4 Planning Meeting<br/>Date: Oct 5, 2025]
        
        Email_Pattern[Email Pattern<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Temporal Window:<br/>-30 days to +7 days<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Characteristics:<br/>â€¢ Sent weeks in advance<br/>â€¢ Meeting invites early<br/>â€¢ Calendar invitations<br/>â€¢ Formal communication]
        
        WA_Pattern[WhatsApp Pattern<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Temporal Window:<br/>-7 days to +2 days<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Characteristics:<br/>â€¢ Cluster 1-3 days around<br/>â€¢ Last-minute coordination<br/>â€¢ Quick updates<br/>â€¢ Informal messaging]
        
        iMsg_Pattern[iMessage Pattern<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Temporal Window:<br/>-14 days to +7 days<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Characteristics:<br/>â€¢ Day-of or day-before<br/>â€¢ Reminders<br/>â€¢ Personal coordination<br/>â€¢ Intermediate timing]
        
        Adaptive[Adaptive Window Logic<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Python function<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>def get_temporal_window<br/>  event, platform:<br/>  if platform == email:<br/>    return -30, +7<br/>  elif platform == whatsapp:<br/>    return -7, +2<br/>  elif platform == imessage:<br/>    return -14, +7<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Dynamic Expansion:<br/>If <5 results found,<br/>expand to Â±30 days universal]
        
        Better_Results[Improved Results<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Precision@10 Improvement:<br/>73% â†’ 85% +12%<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Platform-specific windows<br/>capture natural patterns<br/>better than uniform window]
        
        Event --> Email_Pattern
        Event --> WA_Pattern
        Event --> iMsg_Pattern
        Email_Pattern --> Adaptive
        WA_Pattern --> Adaptive
        iMsg_Pattern --> Adaptive
        Adaptive --> Better_Results
    end
    
    subgraph "Challenge 5: Semantic Richness Variance"
        Rich_Email[Rich Email<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Subject: Quarterly Review<br/>Body: 500 words discussion<br/>Attachments: reports<br/>Thread: 12 messages<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>High information density]
        
        Brief_WA[Brief WhatsApp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ok<br/>ğŸ‘<br/>sure<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Low information density]
        
        Context_Aug[Context Augmentation<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>For brief messages<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Include thread context:<br/>prev_msg_1 + prev_msg_2 +<br/>prev_msg_3 + current_msg<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Improves embedding quality<br/>for short messages]
        
        Emoji_Handler[Emoji Handling<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>spaCy tokenizer preserves<br/>OpenAI captures semantics<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>ğŸ‘ similar to agree, like<br/>ğŸ˜Š similar to happy, positive<br/>ğŸ¤ similar to deal, agreement]
        
        Rich_Email --> Context_Aug
        Brief_WA --> Context_Aug
        Context_Aug --> Emoji_Handler
    end
    
    %% Styling for dark background with high contrast
    
    %% Input/Source nodes - Blue tones
    style WA_Raw fill:#1e40af,stroke:#60a5fa,stroke-width:2px,color:#fff
    style iMsg_Raw fill:#1e40af,stroke:#60a5fa,stroke-width:2px,color:#fff
    style Email_Raw fill:#1e40af,stroke:#60a5fa,stroke-width:2px,color:#fff
    style Query_EN fill:#2563eb,stroke:#60a5fa,stroke-width:2px,color:#fff
    style Event fill:#2563eb,stroke:#60a5fa,stroke-width:2px,color:#fff
    
    %% Processing nodes - Orange/Yellow tones
    style Normalizer fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    style Resolver fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    style ML_Engine fill:#fbbf24,stroke:#fcd34d,stroke-width:3px,color:#000
    style Adaptive fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    style Context_Aug fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    
    %% Output/Result nodes - Green tones
    style Unified fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Canonical fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Results fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Better_Results fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Emoji_Handler fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    
    %% Contact nodes - Purple tones
    style Contact_WA fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    style Contact_iMsg fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    style Contact_Email1 fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    style Contact_Email2 fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    
    %% Message nodes - Cyan tones
    style Msg_EN fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Msg_ES fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Msg_DE fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Msg_JA fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Lang_Detect fill:#0891b2,stroke:#22d3ee,stroke-width:2px,color:#fff
    
    %% Pattern nodes - Pink/Rose tones
    style Email_Pattern fill:#be123c,stroke:#fb7185,stroke-width:2px,color:#fff
    style WA_Pattern fill:#be123c,stroke:#fb7185,stroke-width:2px,color:#fff
    style iMsg_Pattern fill:#be123c,stroke:#fb7185,stroke-width:2px,color:#fff
    
    %% Content nodes - Slate tones
    style Rich_Email fill:#334155,stroke:#94a3b8,stroke-width:2px,color:#fff
    style Brief_WA fill:#334155,stroke:#94a3b8,stroke-width:2px,color:#fff

