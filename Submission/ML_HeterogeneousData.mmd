graph TB
    subgraph "Challenge 1: Platform-Specific Data Formats"
        WA_Raw[WhatsApp Raw Data<br/>JSON from whatsmeow<br/>━━━━━━━━━━━━━━━━━━━━━<br/>external_id: hex string<br/>message.conversation: text<br/>reactions: separate messages<br/>media: thumbnail + S3 key<br/>messageTimestamp: unix]
        
        iMsg_Raw[iMessage Raw Data<br/>SQLite chat.db rows<br/>━━━━━━━━━━━━━━━━━━━━━<br/>ROWID: integer<br/>attributedBody: BLOB<br/>date: Apple Cocoa epoch<br/>reactions: type codes<br/>2000=like, 2001=love]
        
        Email_Raw[Email/Calendar Raw<br/>IMAP MIME multipart<br/>━━━━━━━━━━━━━━━━━━━━━<br/>text/plain + text/html<br/>In-Reply-To headers<br/>quoted-printable encoding<br/>.ics VEVENT attachments<br/>RRULE: recurring events]
        
        Normalizer[Schema Normalizer<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Unified Message Schema<br/>─────────────────────<br/>• Parse platform format<br/>• Convert timestamps<br/>• Merge reactions<br/>• Extract entities<br/>• Decode encodings<br/>• Expand recurrences]
        
        Unified[Unified Message<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Standard JSON schema<br/>─────────────────────<br/>id: UUID<br/>platform: enum<br/>timestamp: ISO-8601<br/>sender: Contact<br/>recipients: Contact array<br/>content: Content<br/>metadata: Metadata<br/>embedding_metadata: NLP]
        
        WA_Raw --> Normalizer
        iMsg_Raw --> Normalizer
        Email_Raw --> Normalizer
        Normalizer --> Unified
    end
    
    subgraph "Challenge 2: Contact Identity Resolution"
        Contact_WA[WhatsApp Contact<br/>━━━━━━━━━━━━━━━━━━━━━<br/>identifier: +1-555-1234<br/>display_name: John Smith]
        
        Contact_iMsg[iMessage Contact<br/>━━━━━━━━━━━━━━━━━━━━━<br/>identifier: john.smith@icloud.com<br/>display_name: John Smith]
        
        Contact_Email1[Work Email Contact<br/>━━━━━━━━━━━━━━━━━━━━━<br/>identifier: john.smith@company.com<br/>display_name: John Smith]
        
        Contact_Email2[Personal Email<br/>━━━━━━━━━━━━━━━━━━━━━<br/>identifier: jsmith@gmail.com<br/>display_name: J. Smith]
        
        Resolver[Probabilistic Resolver<br/>━━━━━━━━━━━━━━━━━━━━━<br/>fuzzywuzzy library<br/>─────────────────────<br/>1. Exact match check<br/>2. Fuzzy name match >80%<br/>3. User confirmation<br/>4. Create/link canonical ID]
        
        Canonical[Canonical Contact<br/>━━━━━━━━━━━━━━━━━━━━━<br/>contact_uuid: abc-123<br/>display_name: John Smith<br/>identifiers:<br/>  • +1-555-1234 WhatsApp<br/>  • john.smith@icloud.com<br/>  • john.smith@company.com<br/>  • jsmith@gmail.com<br/>────────────────────<br/>Benefits:<br/>✓ Cross-platform search<br/>✓ Participant matching<br/>✓ Privacy-preserving local]
        
        Contact_WA --> Resolver
        Contact_iMsg --> Resolver
        Contact_Email1 --> Resolver
        Contact_Email2 --> Resolver
        Resolver --> Canonical
    end
    
    subgraph "Challenge 3: Multilingual Semantic Matching"
        Query_EN[User Query<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Language: English<br/>Text: vacation plans]
        
        Msg_EN[Message English<br/>━━━━━━━━━━━━━━━━━━━━━<br/>vacation plans<br/>embedding: 0.567, ...]
        
        Msg_ES[Message Spanish<br/>━━━━━━━━━━━━━━━━━━━━━<br/>planes de vacaciones<br/>embedding: 0.561, ...]
        
        Msg_DE[Message German<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Urlaubspläne<br/>embedding: 0.543, ...]
        
        Msg_JA[Message Japanese<br/>━━━━━━━━━━━━━━━━━━━━━<br/>計画を休暇<br/>embedding: 0.512, ...]
        
        ML_Engine[OpenAI Embeddings<br/>━━━━━━━━━━━━━━━━━━━━━<br/>text-embedding-3-small<br/>─────────────────────<br/>• Trained on 100+ languages<br/>• Cross-lingual clustering<br/>• Semantic vector space<br/>• Language-agnostic search]
        
        Results[Semantic Search Results<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Cosine Similarity Rankings:<br/>1. vacation plans EN 1.00<br/>2. planes de vacaciones ES 0.82<br/>3. Urlaubspläne DE 0.78<br/>4. 計画を休暇 JA 0.71<br/>────────────────────<br/>MIRACL Benchmark:<br/>• English: 96% accuracy<br/>• Spanish: 94%<br/>• German: 92%<br/>• French: 93%<br/>• Arabic: 88%<br/>• Mandarin: 86%]
        
        Query_EN --> ML_Engine
        Msg_EN --> ML_Engine
        Msg_ES --> ML_Engine
        Msg_DE --> ML_Engine
        Msg_JA --> ML_Engine
        ML_Engine --> Results
        
        Lang_Detect[spaCy Language Detection<br/>━━━━━━━━━━━━━━━━━━━━━<br/>70+ languages<br/>95%+ accuracy<br/>────────────────────<br/>• Display flags in UI<br/>• Language-specific parsing<br/>• Unicode tokenization FTS5<br/>• Lemmatization per language]
        
        ML_Engine -.-> Lang_Detect
    end
    
    subgraph "Challenge 4: Temporal Distribution Variance"
        Event[Calendar Event<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Q4 Planning Meeting<br/>Date: Oct 5, 2025]
        
        Email_Pattern[Email Pattern<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Temporal Window:<br/>-30 days to +7 days<br/>────────────────────<br/>Characteristics:<br/>• Sent weeks in advance<br/>• Meeting invites early<br/>• Calendar invitations<br/>• Formal communication]
        
        WA_Pattern[WhatsApp Pattern<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Temporal Window:<br/>-7 days to +2 days<br/>────────────────────<br/>Characteristics:<br/>• Cluster 1-3 days around<br/>• Last-minute coordination<br/>• Quick updates<br/>• Informal messaging]
        
        iMsg_Pattern[iMessage Pattern<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Temporal Window:<br/>-14 days to +7 days<br/>────────────────────<br/>Characteristics:<br/>• Day-of or day-before<br/>• Reminders<br/>• Personal coordination<br/>• Intermediate timing]
        
        Adaptive[Adaptive Window Logic<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Python function<br/>─────────────────────<br/>def get_temporal_window<br/>  event, platform:<br/>  if platform == email:<br/>    return -30, +7<br/>  elif platform == whatsapp:<br/>    return -7, +2<br/>  elif platform == imessage:<br/>    return -14, +7<br/>────────────────────<br/>Dynamic Expansion:<br/>If <5 results found,<br/>expand to ±30 days universal]
        
        Better_Results[Improved Results<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Precision@10 Improvement:<br/>73% → 85% +12%<br/>────────────────────<br/>Platform-specific windows<br/>capture natural patterns<br/>better than uniform window]
        
        Event --> Email_Pattern
        Event --> WA_Pattern
        Event --> iMsg_Pattern
        Email_Pattern --> Adaptive
        WA_Pattern --> Adaptive
        iMsg_Pattern --> Adaptive
        Adaptive --> Better_Results
    end
    
    subgraph "Challenge 5: Semantic Richness Variance"
        Rich_Email[Rich Email<br/>━━━━━━━━━━━━━━━━━━━━━<br/>Subject: Quarterly Review<br/>Body: 500 words discussion<br/>Attachments: reports<br/>Thread: 12 messages<br/>────────────────────<br/>High information density]
        
        Brief_WA[Brief WhatsApp<br/>━━━━━━━━━━━━━━━━━━━━━<br/>ok<br/>👍<br/>sure<br/>────────────────────<br/>Low information density]
        
        Context_Aug[Context Augmentation<br/>━━━━━━━━━━━━━━━━━━━━━<br/>For brief messages<br/>─────────────────────<br/>Include thread context:<br/>prev_msg_1 + prev_msg_2 +<br/>prev_msg_3 + current_msg<br/>────────────────────<br/>Improves embedding quality<br/>for short messages]
        
        Emoji_Handler[Emoji Handling<br/>━━━━━━━━━━━━━━━━━━━━━<br/>spaCy tokenizer preserves<br/>OpenAI captures semantics<br/>─────────────────────<br/>👍 similar to agree, like<br/>😊 similar to happy, positive<br/>🤝 similar to deal, agreement]
        
        Rich_Email --> Context_Aug
        Brief_WA --> Context_Aug
        Context_Aug --> Emoji_Handler
    end
    
    %% Styling for dark background with high contrast
    
    %% Input/Source nodes - Blue tones
    style WA_Raw fill:#1e40af,stroke:#60a5fa,stroke-width:2px,color:#fff
    style iMsg_Raw fill:#1e40af,stroke:#60a5fa,stroke-width:2px,color:#fff
    style Email_Raw fill:#1e40af,stroke:#60a5fa,stroke-width:2px,color:#fff
    style Query_EN fill:#2563eb,stroke:#60a5fa,stroke-width:2px,color:#fff
    style Event fill:#2563eb,stroke:#60a5fa,stroke-width:2px,color:#fff
    
    %% Processing nodes - Orange/Yellow tones
    style Normalizer fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    style Resolver fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    style ML_Engine fill:#fbbf24,stroke:#fcd34d,stroke-width:3px,color:#000
    style Adaptive fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    style Context_Aug fill:#f97316,stroke:#fb923c,stroke-width:3px,color:#000
    
    %% Output/Result nodes - Green tones
    style Unified fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Canonical fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Results fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Better_Results fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    style Emoji_Handler fill:#065f46,stroke:#10b981,stroke-width:3px,color:#fff
    
    %% Contact nodes - Purple tones
    style Contact_WA fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    style Contact_iMsg fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    style Contact_Email1 fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    style Contact_Email2 fill:#6b21a8,stroke:#a78bfa,stroke-width:2px,color:#fff
    
    %% Message nodes - Cyan tones
    style Msg_EN fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Msg_ES fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Msg_DE fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Msg_JA fill:#0e7490,stroke:#22d3ee,stroke-width:2px,color:#fff
    style Lang_Detect fill:#0891b2,stroke:#22d3ee,stroke-width:2px,color:#fff
    
    %% Pattern nodes - Pink/Rose tones
    style Email_Pattern fill:#be123c,stroke:#fb7185,stroke-width:2px,color:#fff
    style WA_Pattern fill:#be123c,stroke:#fb7185,stroke-width:2px,color:#fff
    style iMsg_Pattern fill:#be123c,stroke:#fb7185,stroke-width:2px,color:#fff
    
    %% Content nodes - Slate tones
    style Rich_Email fill:#334155,stroke:#94a3b8,stroke-width:2px,color:#fff
    style Brief_WA fill:#334155,stroke:#94a3b8,stroke-width:2px,color:#fff

